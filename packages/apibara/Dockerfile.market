FROM quay.io/apibara/sink-postgres:0.4.10

ARG NETWORK_NAME
ARG POSTGRES_CONNECTION_STRING
ARG AUTH_TOKEN
ARG SCRIPT

ENV ENVFILE=${NETWORK_NAME}.env
ENV POSTGRES_CONNECTION_STRING=POSTGRES_CONNECTION_STRING
ENV AUTH_TOKEN=AUTH_TOKEN

COPY src ./data/src
COPY $ENVFILE ./data/.env
COPY ${SCRIPT} ./data/src/script.ts

CMD ["run", "--allow-env=/data/.env", "--allow-env-from-env=POSTGRES_CONNECTION_STRING,AUTH_TOKEN", "/data/src/script.ts"]

